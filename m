Return-Path: <linux-rtc-owner@vger.kernel.org>
X-Original-To: lists+linux-rtc@lfdr.de
Delivered-To: lists+linux-rtc@lfdr.de
Received: from out1.vger.email (out1.vger.email [IPv6:2620:137:e000::1:20])
	by mail.lfdr.de (Postfix) with ESMTP id 7F34864ED69
	for <lists+linux-rtc@lfdr.de>; Fri, 16 Dec 2022 16:06:30 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S231281AbiLPPG2 (ORCPT <rfc822;lists+linux-rtc@lfdr.de>);
        Fri, 16 Dec 2022 10:06:28 -0500
Received: from lindbergh.monkeyblade.net ([23.128.96.19]:39172 "EHLO
        lindbergh.monkeyblade.net" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S231357AbiLPPF4 (ORCPT
        <rfc822;linux-rtc@vger.kernel.org>); Fri, 16 Dec 2022 10:05:56 -0500
Received: from madras.collabora.co.uk (madras.collabora.co.uk [46.235.227.172])
        by lindbergh.monkeyblade.net (Postfix) with ESMTPS id 8CAA213F44;
        Fri, 16 Dec 2022 07:05:52 -0800 (PST)
Received: from mercury (dyndsl-095-033-168-084.ewe-ip-backbone.de [95.33.168.84])
        (using TLSv1.3 with cipher TLS_AES_256_GCM_SHA384 (256/256 bits)
         key-exchange X25519 server-signature RSA-PSS (4096 bits))
        (No client certificate requested)
        (Authenticated sender: sre)
        by madras.collabora.co.uk (Postfix) with ESMTPSA id 2FB156602C94;
        Fri, 16 Dec 2022 15:05:51 +0000 (GMT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/simple; d=collabora.com;
        s=mail; t=1671203151;
        bh=f37gsqS1gV/mnPBoFiZ/C2DxWz6L8bUBLliDSdh3jwE=;
        h=Date:From:To:Cc:Subject:References:In-Reply-To:From;
        b=oLGYIvgfY9eyYbZrr65vcuF1nHKSXSr2OuDwaMYF+zuMwN7qX2kjuf2Lh9p9xKUqO
         ihP9+Gif0egQH0yHFyixQXYXEdB8JItozxvTL7JNQpMQl5Sud650psRTf4TO0Opp1S
         mTpPSYp0BQpyFIplCFtP7XYpFheXStZpb53n3khb+ZaGqsytZzRq0jCg/7SeHUsGPc
         oJSoMsq8nbzLVgSvNHuZF93wSJXnX0zLBlijroWqMgpEJrMtNzDpDgoBZWKTE7z1zE
         soNHFTbXcDXB5ZHq6+mav1VbTqAXgmS/e5ILySd5djkXcebY7EQwpyLX4YpD+ksZG5
         wn+swM2OLxaow==
Received: by mercury (Postfix, from userid 1000)
        id E26751060F45; Fri, 16 Dec 2022 16:05:48 +0100 (CET)
Date:   Fri, 16 Dec 2022 16:05:48 +0100
From:   Sebastian Reichel <sebastian.reichel@collabora.com>
To:     Marek Vasut <marex@denx.de>
Cc:     devicetree@vger.kernel.org,
        Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>,
        Alessandro Zummo <a.zummo@towertech.it>,
        Alexandre Belloni <alexandre.belloni@bootlin.com>,
        Rob Herring <robh+dt@kernel.org>,
        Krzysztof Kozlowski <krzysztof.kozlowski+dt@linaro.org>,
        linux-rtc@vger.kernel.org
Subject: Re: [PATCH v3 2/2] dt-bindings: rtc: m41t80: Mark the clock: subnode
 as deprecated
Message-ID: <20221216150548.dttzfmdbqzk6r42z@mercury.elektranox.org>
References: <20221211205124.23823-1-marex@denx.de>
 <20221211205124.23823-2-marex@denx.de>
 <20221215180659.sa54lkinwxoiz7bb@mercury.elektranox.org>
 <d9910a7a-9997-c157-9a71-8ef7ee34be25@denx.de>
 <20221216142408.6x3e5dhtdvgiewtb@mercury.elektranox.org>
 <f65773a2-71a7-6d54-1ac2-9987ed035b16@denx.de>
MIME-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha512;
        protocol="application/pgp-signature"; boundary="ap5yfdqwxii6evis"
Content-Disposition: inline
In-Reply-To: <f65773a2-71a7-6d54-1ac2-9987ed035b16@denx.de>
X-Spam-Status: No, score=-2.1 required=5.0 tests=BAYES_00,DKIM_SIGNED,
        DKIM_VALID,DKIM_VALID_AU,DKIM_VALID_EF,SPF_HELO_NONE,SPF_PASS
        autolearn=ham autolearn_force=no version=3.4.6
X-Spam-Checker-Version: SpamAssassin 3.4.6 (2021-04-09) on
        lindbergh.monkeyblade.net
Precedence: bulk
List-ID: <linux-rtc.vger.kernel.org>
X-Mailing-List: linux-rtc@vger.kernel.org


--ap5yfdqwxii6evis
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

Hi,

On Fri, Dec 16, 2022 at 03:36:17PM +0100, Marek Vasut wrote:
> On 12/16/22 15:24, Sebastian Reichel wrote:
> > On Thu, Dec 15, 2022 at 08:39:47PM +0100, Marek Vasut wrote:
> > > On 12/15/22 19:06, Sebastian Reichel wrote:
> > > > On Sun, Dec 11, 2022 at 09:51:24PM +0100, Marek Vasut wrote:
> > > > > The clock {} subnode seems like it is describing an always-on clo=
ck
> > > > > generated by the PMIC. This should rather be modeled by consumer =
of
> > > > > the clock taking phandle to the RTC node itself, since it already
> > > > > does have clock-cells and all. Since there are no users of the cl=
ock
> > > > > subnode in tree anyway, mark it as deprecated to avoid proliferat=
ion
> > > > > of this approach.
> > > > >=20
> > > > > Acked-by: Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>
> > > > > Signed-off-by: Marek Vasut <marex@denx.de>
> > > > > ---
> > > > > Cc: Alessandro Zummo <a.zummo@towertech.it>
> > > > > Cc: Alexandre Belloni <alexandre.belloni@bootlin.com>
> > > > > Cc: Rob Herring <robh+dt@kernel.org>
> > > > > Cc: Krzysztof Kozlowski <krzysztof.kozlowski+dt@linaro.org>
> > > > > Cc: linux-rtc@vger.kernel.org
> > > > > To: devicetree@vger.kernel.org
> > > > > ---
> > > > > V2: - Add AB from Krzysztof
> > > > > V3: - No change
> > > > > ---
> > > >=20
> > > > I just noticed this by accident. Basically everything in the patch
> > > > description is wrong:
> > > >=20
> > > > 1. There is a in-tree user: arch/arm/boot/dts/imx6dl-qmx6.dtsi
> > >=20
> > > Sorry, I missed this one.
> > >=20
> > > > 2. The PMIC has nothing to do with this
> > >=20
> > > In [3] the commit message claims the PMIC supplies 32kHz clock to i.M=
X6 CKIL,
> > > which per IMX6DQRM rev.6 Table 18-3 row SNVS indirectly supplies SNVS=
 RTC.
> > > This reminded me of commit:
> >=20
> > The word PMIC is not mentioned once in [3].
>=20
> s@PMIC@m41t62 RTC@, sorry.
>=20
> > PMIC is not involved.
> > The QMX6 32khz chain is like this:
> >=20
> > 32kHz crystal -> m41t62 crystal input
> > m41t62 clock output -> i.MX6 CKIL
> >=20
> > > 9509593f327ac ("arm64: dts: imx8mm: Model PMIC to SNVS RTC clock path=
 on
> > > Data Modul i.MX8M Mini eDM SBC")
> > >=20
> > > which solves exactly the same problem, system hangs when 32 kHz clock=
 are
> > > stopped, except this time on i.MX8MM, clock are generated by PMIC on =
I2C
> > > (notice how the PMIC is referenced directly) and the clock are suppli=
ed to
> > > the SVNS RTC XTal terminals.
> > >=20
> > > I wonder if this could be reused on the QMX6 board too?
> >=20
> > IIRC On i.MX6 referencing the I2C connected RTC results in boot
> > hanging forever when trying to get the ckil clock in
> > imx6q_clocks_init. At least it used to be the case when I was
> > working on this - I no longer have access to the boards. Of course
> > properly referencing the RTC clock was the first route I tried.
>=20
> Hmmmmm, what shall we do, un-deprecate the clock sub-node?

Depends on the exact meaning of "deprecate: true". I think we all
agree, that it's better to avoid the sub-node and only use it when
it's really required. But having a deprecation warning for an
in-tree user without a clear path forward also seems to be annoying.
I think it makes sense for the DT binding maintainers (Rob/Krzysztof)
to comment on this.

-- Sebastian

--ap5yfdqwxii6evis
Content-Type: application/pgp-signature; name="signature.asc"

-----BEGIN PGP SIGNATURE-----

iQIzBAABCgAdFiEE72YNB0Y/i3JqeVQT2O7X88g7+poFAmOciT8ACgkQ2O7X88g7
+prbyg//Te4W2nJoJpYxXQo9+XwzN+ClJ9JIuyoC+/bqmswiHnRPjueQOKkHBSsB
BRjq035U2RVje+bo0BrGfCrz6UB8LrfJWfFGxu7Nk9UPejAuZO3WhLrdSpAoQRGK
E+hl7kJ+Mmr6e/PhfipfaHdwmnLYoO6gkqpEQ50RlxPmPzinA4d0O15CJKOMs0R0
KyjJvZdwj7cmI5E7oJFCU4U22+mWl6FOa4LXAW+34Hfp3EzzRt0iC6WlcqmtEGbi
gLwOzEuqYgKcYVIHn42xKx9I/6PkEt/qynNL5OSzcWvQbhBwtciGprZjRmteEouM
1GZo9YUS3D3ftDMkr4bHgBAa+Fh5qXivNBu81jQOYf3JKqRk4rHbqNhW3qxOJFYW
BVUGMpQEo3RR4cJ0aKFFOJpxjgoWJifUl2233P9i2t1unw5PLBy07JVPkf3/+EKv
DqpD7a+SWCZEk2DJVPsxwF2+HBGtECAX/M5bP4TPLXqRdrQXze2HcnhsyJYhtra0
LC0m6mW/IjhTUCBjAJLkcfd3C7rJyoH4fs6c53bFJ9l6M4lGgMVKDyufBK2K1yso
Lz93i0EjzefXsi9WnyhN3fl1+D+Z6oZeHwmyFVEQCw+rZPZSPPj79gTDB8YJ9fiq
RhuropFnPYI7//kyzjv0jhI5xSdVOtoCkwFGd97u1Pdry5QDcyw=
=763d
-----END PGP SIGNATURE-----

--ap5yfdqwxii6evis--
